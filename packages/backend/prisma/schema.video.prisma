// Add to packages/backend/prisma/schema.prisma

model Video {
  id                String    @id @default(cuid())
  authorId          String
  author            User      @relation(fields: [authorId], references: [id], onDelete: Cascade)

  fileName          String
  fileSize          Int       // in bytes
  tempPath          String?   // temporary file path during upload

  status            VideoStatus @default(UPLOADING)
  // UPLOADING -> QUEUED_FOR_TRANSCODING -> TRANSCODING -> COMPLETED or FAILED

  thumbnail         String?   // path to generated thumbnail
  manifestUrl       String?   // path to HLS playlist (m3u8)
  errorMessage      String?   // error details if transcoding failed

  duration          Int?      // video duration in seconds (calculated after transcoding)
  width             Int?      // video width in pixels
  height            Int?      // video height in pixels

  metadata          Json?     // additional metadata (codec, bitrate, etc)

  createdAt         DateTime  @default(now())
  completedAt       DateTime?
  updatedAt         DateTime  @updatedAt

  // Relations
  posts             Post[]    // videos in posts

  @@index([authorId])
  @@index([status])
  @@index([createdAt])
}

enum VideoStatus {
  UPLOADING
  QUEUED_FOR_TRANSCODING
  TRANSCODING
  COMPLETED
  FAILED
}

// Update User model to include videos relation
model User {
  // ... existing fields ...
  videos    Video[] // Add this line
}

// Update Post model to include videos
model Post {
  // ... existing fields ...
  videos    Video[] // Add this line
}
